{% extends 'base.html' %} {% load static %}{% block title %}Settings{% endblock %} 
{% block content %}
<style>
    body{
        margin-top:20px;
    }
    
    .ui-w-80 {
        width: 80px !important;
        height: auto;
    }
    
    .btn-default {
        border-color: rgba(24,28,33,0.1);
        background: rgba(0,0,0,0);
        color: #4E5155;
    }
    
    label.btn {
        margin-bottom: 0;
    }
    
    .btn-outline-primary {
        border-color: #26B4FF;
        background: transparent;
        color: #26B4FF;
    }
    
    .btn {
        cursor: pointer;
    }
    
    .text-light {
        color: #babbbc !important;
    }
    
    .btn-facebook {
        border-color: rgba(0,0,0,0);
        background: #3B5998;
        color: #fff;
    }
    
    .btn-instagram {
        border-color: rgba(0,0,0,0);
        background: #000;
        color: #fff;
    }
    
    .card {
        background-clip: padding-box;
        box-shadow: 0 1px 4px rgba(24,28,33,0.012);
    }

  
    
    .row-bordered {
        overflow: hidden;
        background-image: url('{% static "images/parch.jpg" %}');

    }
    
    .account-settings-fileinput {
        position: absolute;
        visibility: hidden;
        width: 1px;
        height: 1px;
        opacity: 0;
    }
    .account-settings-links .list-group-item.active {
        font-weight: bold !important;
    }
    html:not(.dark-style) .account-settings-links .list-group-item.active {
        background: transparent !important;
    }
    .account-settings-multiselect ~ .select2-container {
        width: 100% !important;
    }
    .light-style .account-settings-links .list-group-item {
        padding: 0.85rem 1.5rem;
        border-color: rgba(24, 28, 33, 0.03) !important;
    }
    .light-style .account-settings-links .list-group-item.active {
        color: #4e5155 !important;
    }
    .material-style .account-settings-links .list-group-item {
        padding: 0.85rem 1.5rem;
        border-color: rgba(24, 28, 33, 0.03) !important;
    }
    .material-style .account-settings-links .list-group-item.active {
        color: #4e5155 !important;
    }
    .dark-style .account-settings-links .list-group-item {
        padding: 0.85rem 1.5rem;
        border-color: rgba(255, 255, 255, 0.03) !important;
    }
    .dark-style .account-settings-links .list-group-item.active {
        color: #fff !important;
    }
    .light-style .account-settings-links .list-group-item.active {
        color: #4E5155 !important;
    }
    .light-style .account-settings-links .list-group-item {
        padding: 0.85rem 1.5rem;
        border-color: rgba(24,28,33,0.03) !important;
    }
    
    .account-settings-links .list-group-item {
      background-color: black;
      color: white;
      transition: background-color 0.3s ease, color 0.3s ease;
      }
    
      .account-settings-links .list-group-item:hover {
        background-image: url('{% static "images/parch.jpg" %}');

        color: red;
      }
</style>
<div class="container light-style flex-grow-1 container-p-y">

  <h4 class="font-weight-bold py-3 mb-4 text-center">
    Account settings
  </h4>

    <div class="card overflow-hidden">
      <div class="row no-gutters row-bordered row-border-light">
        <div class="col-md-3 pt-0">
          <div class="list-group list-group-flush account-settings-links">
            <a class="list-group-item list-group-item-action" data-toggle="list" href="#account-general">General</a>
            <a class="list-group-item list-group-item-action" data-toggle="list" href="#account-info">Info</a>
          </div>
        </div>
        <div class="col-md-9">
          <div class="tab-content">
            <div class="tab-pane fade active show" id="account-general">

              <div class="card-body media align-items-center">
                <img id="userImage" src="{{request.user.profile.profile_pic.url}}" alt="" class="d-block ui-w-80">
                <div class="media-body ml-4">
                  <label for="fileInput" class="btn btn-outline-primary">
                    Upload new photo
                    <input id="fileInput" type="file" name= "profile_pic" class="account-settings-fileinput" onchange="updateImage(this)">
                  </label> &nbsp;
                  <button type="button" class="btn btn-default md-btn-flat" onclick="resetImage()">Reset</button>
              
                  <div class="text-light small mt-1">Allowed JPG, GIF, or PNG. Max size of 800K</div>
                </div>
              </div>
              <hr class="border-light m-0">

              <div class="card-body">
                <div class="form-group mb-4">
                    <label class="form-label">Username</label>
                    <input type="text" class="form-control mb-6" name="user" placeholder="{{request.user}}">
                </div>
                <div class="form-group">
                    <label class="form-label">Role</label>
                    <input type="text" class="form-control" name= "role" placeholder="{{request.user.profile.role}}">
                </div>
            
            </div>
            

            </div>
            <div class="tab-pane fade" id="account-info">
              <div class="card-body pb-2">
                <div class="form" action="{% url 'changepassword' %}" method="POST">
                  <div class="form-group">
                    <label class="form-label">Current password</label>
                    <input type="password" id="id_old_password" class="form-control">
                  </div>

                  <div class="form-group">
                    <label class="form-label">New password</label>
                    <input type="password" id="id_new_password" class="form-control">
                  </div>

                  <div class="form-group">
                    <label class="form-label">Repeat new password</label>
                    <input id="id_new_password2" type="password" class="form-control">
                  </div>
                  <button class="btn btn-primary" type="submit">Reset Password</button>
                </div> 
              </div>
              <div class="card-body pb-2">

                <div class="form-group">
                  <label class="form-label">Bio</label>
                  <textarea class="form-control" rows="5">{{ request.user.user_set.bio }}</textarea>
                </div>
                <div class="form-group">
                  <label class="form-label">Birthday</label>
                  <input type="text" class="form-control" value="May 3, 1995">
                </div>
                <div class="form-group">
                  <label class="form-label">Country</label>
                  <select class="custom-select">
                    <option>USA</option>
                    <option selected="">Canada</option>
                    <option>UK</option>
                    <option>Germany</option>
                    <option>France</option>
                  </select>
                </div>
                <hr class="border-light m-0">
              <div class="card-body pb-2">

                <h6 class="mb-4">Contacts</h6>
                <div class="form-group">
                  <label class="form-label">Phone</label>
                  <input type="text" class="form-control" value="+0 (123) 456 7891">
                </div>
                <div class="form-group">
                  <label class="form-label">Website</label>
                  <input type="text" class="form-control" value="">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="text-right mt-3">
      <button type="button" class="btn btn-primary" id="saveChangesBtn">Save changes</button>
      <button type="button" class="btn btn-default" id="cancelBtn">Cancel</button>
    </div>

  </div>
  <script>
    function getCookie(name) {
      var cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
          var cookie = cookies[i].trim();
          // Does this cookie string begin with the name we want?
          if (cookie.substring(0, name.length + 1) === name + '=') {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }
    var selectedImageUrl = "https://bootdey.com/img/Content/avatar/avatar1.png";
  
    function updateImage(input) {
      var reader = new FileReader();
  
      reader.onload = function (e) {
        document.getElementById("userImage").src = e.target.result;
  
        // Update the global variable with the selected image URL
        selectedImageUrl = e.target.result;
      };
  
      reader.readAsDataURL(input.files[0]);
    }
  
    function resetImage() {
      // Reset the image to the default one
      document.getElementById("userImage").src = "https://bootdey.com/img/Content/avatar/avatar1.png";
      // Reset the file input (optional)
      document.getElementById("fileInput").value = "";
  
      // Reset the global variable to the default image URL
      selectedImageUrl = "https://bootdey.com/img/Content/avatar/avatar1.png";
    }
  
    document.addEventListener('DOMContentLoaded', function () {
      // Function to show/hide tabs
      function showTab(tabId) {
        document.querySelectorAll('.tab-pane').forEach(function (tab) {
          tab.classList.remove('show', 'active');
        });
  
        var activeTab = document.querySelector(tabId);
        if (activeTab) {
          activeTab.classList.add('show', 'active');
        }
      }
    })
  
      // Event listener for clicking on tab links
      document.querySelectorAll('.account-settings-links .list-group-item').forEach(function (button) {
        button.addEventListener('click', function (event) {
          event.preventDefault();
          var tabId = this.getAttribute('href');
          showTab(tabId);
        });
      });
  
      // Save changes and cancel buttons
      var saveChangesBtn = document.getElementById('saveChangesBtn');
      if (saveChangesBtn) {
        saveChangesBtn.addEventListener('click', function () {
          // Get the updated data from the form
          var username = document.querySelector('#account-general input[name="user"]').value;
          var role = document.querySelector('#account-general input[name="role"]').value;
          var profile_pic = document.querySelector('#account-general input[name="profile_pic"]').value;

          // Create a data object to send to the server
          var data = {
            user: username,
            role: role,
            profile_pic: profile_pic,
            // Add other fields as needed
          };

          // Send the updated data to the server using AJAX
          // Include the CSRF token in the headers
          fetch('/update_profile/', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'X-CSRFToken': getCookie('csrftoken'), // Include the CSRF token here
            },
            body: JSON.stringify(data),
          })
            .then(response => response.json())
            .then(result => {
              console.log('Profile updated successfully:', result);
              // You can handle the success response as needed
            })
            .catch(error => {
              console.error('Error updating profile:', error);
              // Handle the error as needed
            });
        });
      };
  </script>
{% endblock %}